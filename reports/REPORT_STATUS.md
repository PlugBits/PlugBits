# 開発状況とロードマップ

## 現状まとめ
### 1. Cloudflare Worker / API
- `/render` `/render-preview` を実装し、テンプレートは KV に保存。
- pdf-lib でラベル/テキスト/テーブル要素を描画。フォントは KV に無い場合でも自動で取得・キャッシュ。
- CORS/認証は `x-api-key` ベース。kintone REST へは Worker から直接アクセス。

### 2. React 帳票デザイナー
- テンプレ一覧、エディタ、プレビューを実装。ドラッグ&リサイズ、要素追加（ラベル/テキスト/テーブル）、テーブル列編集が可能。
- オートセーブ機能（4秒無操作で保存）、トースト通知、プレビュー前の保存→PDF生成ステータス表示を追加。
- テンプレ追加/削除/再読み込みは API と同期し、エラー時はトーストで表示。

### 3. kintone プラグイン
- 設定画面（APIベースURL、Worker APIキー、kintone APIトークン、テンプレID、添付フィールド）を実装。
- レコード詳細画面に「PDF出力 (PlugBits)」ボタンを追加し、Worker `/render` 呼び出し→PDF添付まで実装済み。
- 実行中はボタンにスピナーを表示し、成功/失敗をトースト表示。設定未完了時はツールバーに警告を表示。
- `npm run pack` で `plugin/dist/plugin.zip` を生成し、kintoneへアップロード可能。

## ロードマップ
1. **プラグイン仕上げ**
   - 設定画面にヘルプ/入力例を追加し、README に導入手順を整理。
   - Worker/kintone 認証エラーの再試行・警告ログを整備。
   - 実レコード確認用のデバッグモードやログ出力を検討。

2. **帳票デザイナー拡張**
   - 画像要素や複数ページ対応、Undo/Redo、グリッド配置など操作性アップ。
   - テンプレ一覧の検索やタグ付け、チーム利用機能の検討。

3. **kintone 連携強化**
   - Worker `/render` に渡す情報の再検討（プラグインから record JSON を送るなど）で依存を減らす。
   - 実レコードを使った PDF プレビュー/保存テスト。ログや再試行UIの整備。

4. **運用準備**
   - KV データの管理、Secrets、Cloudflare/プラグインのデプロイ手順を文書化。
   - CI/CD（Worker deploy、プラグイン pack）の自動化を検討。
