# 2026-02-xx 進捗まとめ：Saved template / Record PDF 一致 + diffノイズ残り

## 状況整理（現状）
- 見た目の整合：
  - ADMIN TUNER / CANVAS / Current draft PDF preview は一致
  - Saved template PDF preview と 実レコード出力PDF は一致
  - つまり「Saved templateが真の出力ソース」で、現実出力はOK

## 追加したデバッグログ（有効）
- /render 入口：DBG_RENDER_INCOMING
- 解決後：DBG_RENDER_RESOLVED（resolvedSource / hash / elementsCount / ids sample）
- estimate passthrough：DBG_ESTIMATE_PASSTHROUGH（true/false + reason）

## 解決できたこと（重要）
- draft vs saved で resolvedTemplateHash がズレる問題の原因を特定
- 保存パスの欠落（特に alignX）を潰して、hashDraft===hashSaved / ok:true を達成

## 現在残っている問題（機能ではなくログのノイズ）
- DBG_CLIENT_SAVE_VERIFY は ok:true / hash一致 ✅
- ただし diff が残る（表現差）：
  - doc_no_label.slotId が draft=__UNDEFINED__ / saved=__MISSING__
  - logo で alignX/fontSize が diff に出る（type=imageなのに比較対象に入っている）
  - titleをleftにすると draft側だけ left が入るなど、optional key の表現差が残る

## 次やること（仕上げ）
- diff/verify の normalize を強化し、意味のない差分を0にする
  - undefined と「キー無し」を同一視（両方 missing 扱い）
  - slotId は null/undefined/missing を同一視
  - fontSize は text 要素のみ比較対象（logo/imageは無視）
  - alignX は text 要素のみ比較対象（logo/imageは無視）
- ok:true（hash一致）の場合は、DBG_ELEM_DIFF を原則出さない（normalize後に差分がある時だけ出す）