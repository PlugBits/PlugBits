<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>%%TITLE_JA%% | Kintone向けミニプラグイン</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="description" content="%%SUMMARY_JA%%">
  <link rel="stylesheet" href="../style.css">
</head>
<body class="kb-root">
  <div class="kb-container kb-topbar">
    <a class="kb-back" href="../index.html">← 商品一覧に戻る</a>
    <div class="kb-language-switcher">
      <a class="kb-lang" href="en/%%SLUG%%.html">EN</a>
      <button class="kb-currency-btn active" data-currency="JPY">JPY</button>
      <button class="kb-currency-btn" data-currency="USD">USD</button>
    </div>
  </div>

  <!-- Hero -->
  <header class="kb-product-hero kb-product-hero--split">
    <div class="kb-hero-col">
      <h1>%%TITLE_JA%%</h1>
      <p class="kb-summary">%%SUMMARY_JA%%</p>
      <div class="kb-tags">%%TAGS_JA_HTML%%</div>
      <div class="kb-hero-side">
        <img class="kb-hero-image" src="../%%HERO_IMAGE%%" alt="%%TITLE_JA%%">
      </div>
      <div class="kb-price-box">
        <div id="product-price" data-price-jpy="%%PRICE_JPY%%" data-price-usd="%%PRICE_USD%%">¥%%PRICE_JPY%%</div>
        <a class="kb-buy-btn" href="%%PURCHASE_URL%%" target="_blank" rel="noopener">購入</a>
      </div>
    </div>
  </header>

  <!-- 詳細情報 -->
  <section class="kb-section kb-container">
    <div class="kb-info-grid">
      <div><strong>対応画面</strong><p>%%SUPPORTED_SCREENS_JA%%</p></div>
      <div><strong>カテゴリ</strong><p>%%CATEGORY_JA%%</p></div>
      <div><strong>ファイルサイズ</strong><p>%%FILE_SIZE_JA%%</p></div>
      <div><strong>更新日</strong><p>%%UPDATED_AT_JA%%</p></div>
    </div>
  </section>

  <section class="kb-section kb-container">
    <h2>機能</h2>
    <ul class="kb-feature-list">%%FEATURES_JA_HTML%%</ul>
  </section>

  <section class="kb-section kb-container">
    <h2>スクリーンショット</h2>
    <div class="kb-screenshots">%%SCREENSHOTS_JA_HTML%%</div>
  </section>

  <section class="kb-section kb-container">
    <h2>使い方</h2>
    <div class="kb-steps">%%STEPS_JA_HTML%%</div>
  </section>

  <section class="kb-section kb-container">
    <h2>制限事項</h2>
    <ul class="kb-limitation-list">%%LIMITATIONS_JA_HTML%%</ul>
  </section>

  <section class="kb-section kb-container">
    <h2>よくある質問</h2>
    <div class="kb-faq">%%FAQ_JA_HTML%%</div>
  </section>

  <section class="kb-section kb-container">
    <h2>関連商品</h2>
    <div class="kb-related-products">%%RELATED_JA_HTML%%</div>
  </section>

  <footer class="kb-footer kb-container">
    <nav class="kb-footer-links">
      <a href="mailto:%%SUPPORT_MAIL%%">不具合報告</a>
      <a href="../terms.html">利用規約</a>
    </nav>
    <small>%%SITE_COPYRIGHT%%</small>
  </footer>

  <!-- 通貨切替 -->
  <script>
    (function(){
    const JPY = 'JPY', USD = 'USD';
    const $btns = document.querySelectorAll('.kb-currency-btn');
  
    // 既存の選好 or lang既定（英語ページなら初回USD）
    const pageLang = document.documentElement.lang || 'ja';
    let preferred = localStorage.getItem('preferred-currency');
    if (!preferred) preferred = (pageLang.startsWith('en') ? USD : JPY);
  
    function render(cur){
      // 一覧/詳細どちらでも動くように対象を広げる
      document.querySelectorAll(
        '#product-price, .kb-price, .kb-price-badge, [data-price-jpy][data-price-usd]'
      ).forEach(el => {
        const j = el.getAttribute('data-price-jpy');
        const u = el.getAttribute('data-price-usd');
        if (cur === USD && u) el.textContent = '$' + u;
        else if (j) el.textContent = '¥' + j;
      });
  
      $btns.forEach(b => b.classList.toggle('active', b.dataset.currency === cur));
        localStorage.setItem('preferred-currency', cur);
      }
    
      $btns.forEach(b => b.addEventListener('click', () => render(b.dataset.currency)));
      render(preferred);
    })();
  </script>
</body>
</html>
